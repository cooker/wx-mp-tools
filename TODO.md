# 项目分析报告 · Token 消耗与提示词策略

## 一、项目概览

### 1.1 技术栈

| 维度 | 内容 |
|------|------|
| 框架 | Vue 3 (Composition API) + Vue Router 5 (Hash) |
| 构建 | Vite 5 |
| 结构 | 模块化：nav / prompts / shared |
| 规模 | 源码约 2.2k 行，23 个文件 |

### 1.2 目录与规模

```
src/
├── config/        2 文件   ~160 行
├── modules/       11 文件  ~1.5k 行
├── composables/   2 文件   ~192 行
├── router/        1 文件    17 行
├── styles/        2 文件    73 行
├── utils/         2 文件    26 行
├── App.vue        152 行
└── main.js        6 行
```

### 1.3 复杂度评估

| 维度 | 评级 | 说明 |
|------|------|------|
| 业务逻辑 | 低 | 以配置驱动为主，逻辑集中在 composables |
| 组件耦合 | 低 | 模块边界清晰，依赖可追溯 |
| 样式复杂度 | 低 | CSS 变量 + 少量 scoped |
| 数据流 | 简单 | 无全局状态，仅 config + composables |

---

## 二、迭代场景与 Token 消耗预估

### 2.1 单次请求典型 Token 构成

| 组成部分 | 预估范围 | 说明 |
|----------|----------|------|
| 系统提示 | 200–500 | Cursor 默认 + 项目规则 |
| 用户输入 | 50–500 | 需求描述 + @ 引用 |
| 上下文（代码） | 1k–15k | 取决于引用范围与对话轮次 |
| 输出 | 200–3k | 代码变更 + 说明 |

### 2.2 按迭代类型预估

| 迭代类型 | 典型任务 | 预估 Token/次 | 单轮总 token | 建议 |
|----------|----------|---------------|--------------|------|
| **微调** | 改 nav/prompt 配置、改文案、样式微调 | 500–1.5k | 2k–4k | 直接 @ 配置文件，不拉全项目 |
| **小改** | 新增 1 个工具卡片、1 个提示词、修改单个组件 | 2k–5k | 5k–10k | @ 相关组件 + config |
| **中改** | 新功能（如导出、暗色切换）、重构单个模块 | 5k–12k | 10k–25k | 先写设计/拆任务，再按文件 @ |
| **大改** | 新模块（如用户系统）、全局架构调整 | 12k–30k | 25k–60k | 拆分多轮，每次聚焦 1 个模块 |

### 2.3 常见操作粗略 Token 区间

- 仅改 `nav.config.js` / `prompt.config.js`：约 **1.5k–3k**
- 修改单个 Vue 组件（<200 行）：约 **3k–6k**
- 新增一个 nav/prompts 下的子功能：约 **8k–15k**
- 全量重构或新模块：约 **20k–50k**（建议拆成多轮）

---

## 三、最优提示词方案

### 3.1 原则：缩小上下文、明确目标

1. **@ 指定文件**：只引用与当前任务直接相关的文件，避免 `@src/` 或 `@整个项目`。
2. **一次一事**：一次对话只处理一个清晰目标，避免「顺便改一下」。
3. **先设计再实现**：大改动先在 `design-system/` 或 `TODO.md` 写明方案，再分步实现。

### 3.2 按任务类型的推荐写法

#### 配置类（低 Token）

```
在 nav.config.js 中新增一个分类「效率工具」，并添加 3 个常用链接。
```

- 建议：只 @ `nav.config.js` 或 `prompt.config.js`。

#### 单组件修改（中 Token）

```
@src/modules/nav/components/ToolCard.vue 增加悬停时显示描述的气泡提示。
```

- 建议：@ 目标组件 + `style.css` / `styles/variables.css`（若涉及样式）。

#### 新功能（高 Token）

```
在提示词模块中新增「收藏提示词」功能，参考 useFavorites 的 localStorage 逻辑。
```

- 建议：
  - 第 1 轮：@ `useFavorites.js`、`prompt.config.js`、`PromptCard.vue`，先定义接口和数据结构。
  - 第 2 轮：@ `usePrompts.js`、`PromptSection.vue`，实现收藏逻辑与展示。

#### 跨模块改动（高 Token）

```
统一把 Minimalism 深色主题改成浅色主题。
```

- 建议：
  - 第 1 轮：@ `styles/variables.css`、`styles/global.css`，先改配色变量。
  - 第 2 轮：按需 @ 各模块组件，微调边框、文字对比度等。

### 3.3 避免的用法

| 避免 | 推荐 |
|------|------|
| 「看看整个项目，然后重构」 | 明确要改的模块和文件，逐个 @ |
| 「顺便把 XXX 也一起改了」 | 单独开一轮对话处理 |
| 不说明具体文件 | 使用 @ 精确到文件或目录 |
| 一次性提 5 个互不相关需求 | 拆成 5 次，每次一个任务 |

### 3.4 可复用的「任务模板」

```
任务：[类型] [具体目标]
涉及文件：@path/to/file1 @path/to/file2
约束：保持现有 [nav/prompts/shared] 模块结构，符合 design-system 规范
```

示例：

```
任务：在 PromptCard 中增加「展开全文」按钮
涉及文件：@src/modules/prompts/components/PromptCard.vue @src/styles/variables.css
约束：保持 Minimalism 风格，支持 prefers-reduced-motion
```

---

## 四、Token 节省检查清单

- [ ] 只 @ 与当前任务直接相关的文件
- [ ] 单次对话只解决一个明确需求
- [ ] 大改动先写设计或任务拆解
- [ ] 配置类任务优先只改 config
- [ ] 跨模块任务拆成多轮，按模块依次处理
- [ ] 利用 `design-system/` 与 `README.md` 作为上下文说明，减少重复描述

---

## 五、后续迭代建议

1. **集中样式**：若继续把组件 scoped 样式迁到 `styles/`，建议按模块分批进行（nav → prompts → shared），每批约 5k–8k token。
2. **新模块**：新增模块前在 `TODO.md` 或 `design-system/pages/` 写明目录与接口，再分步实现，可显著降低单次对话 token。
3. **文档同步**：每次有新功能或结构调整时，更新 `README.md`，便于后续用文档替代大段代码上下文。

---

*最后更新：基于当前模块化结构（nav / prompts / shared）与约 2.2k 行源码规模*
